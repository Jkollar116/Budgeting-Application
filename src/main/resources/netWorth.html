<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Net Worth Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <div class="logo">CashClimb</div>
    <nav>
        <ul class="nav-items">
            <li class="profile-link-container">
                <a href="profile.html">
                    <img id="navProfileImage" class="nav-profile-img" alt="Profile" />
                </a>
                <a href="profile.html" class="active">Profile</a>
            </li>
        </ul>
    </nav>
</header>
<button class="drawer-toggle" onclick="toggleDrawer()">â˜°</button>
<nav class="drawer" id="sideDrawer">
    <ul>
        <li><a href="home.html">Dashboard</a></li>
        <li><a href="alerts.html">Alerts Page (Not Done)</a></li>
        <li><a href="assetsLiabilities.html" class="active">Assets &amp; Liabilities</a></li>
        <li><a href="bills.html">Bills Page</a></li>
        <li><a href="budget.html">Budget</a></li>
        <li><a href="chat.html">Chat</a></li>
        <li><a href="crypto.html">Crypto</a></li>
        <li><a href="expenses.html">Expenses</a></li>
        <li><a href="income.html">Income</a></li>
        <li><a href="leaderboard.html">Leaderboard</a></li>
        <li><a href="netWorth.html">Net Worth</a></li>
        <li><a href="tips.html">Tips</a></li>
        <li><a href="savedTips.html">Saved Tips</a></li>
        <li><a href="stocks.html">Stocks</a></li>
        <li><a href="tax.html">Tax</a></li>
        <li><a href="profile.html">Profile</a></li>
        <li><a href="settings.html">Settings</a></li>
        <li><a href="/logout">Logout</a></li>
    </ul>
</nav>

<main>
    <div class="hero">
        <div class="header-content">
            <h1>Net Worth Calculator</h1>
            <p>Enter your financial information below.</p>
        </div>
    </div>
    <div class="container">
        <form id="netWorthForm" class="profile-form">
            <div class="form-group">
                <label for="assetsLiabilities">Assets - Liabilities ($)</label>
                <input type="number" id="assetsLiabilities" name="assetsLiabilities" required>
            </div>
            <div class="form-group">
                <label for="crypto">Crypto Holdings ($)</label>
                <input type="number" id="crypto" name="crypto" required>
            </div>
            <div class="form-group">
                <label for="stocks">Stock Holdings ($)</label>
                <input type="number" id="stocks" name="stocks" required>
            </div>

            <div id="result" class="result-container"></div>

            <button type="button" class="submit-btn" onclick="calculateNetWorth()">Calculate</button>
            <button type="submit" class="submit-btn">Save Net Worth</button>
        </form>
    </div>
</main>

<script>
    function toggleDrawer() {
        document.getElementById('sideDrawer').classList.toggle('collapsed');
    }

    function getThemePreference(name) {
        const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        return match ? match[2] : null;
    }

    function calculateNetWorth() {
        const aL = parseFloat(document.getElementById("assetsLiabilities").value) || 0;
        const crypto = parseFloat(document.getElementById("crypto").value) || 0;
        const stocks = parseFloat(document.getElementById("stocks").value) || 0;
        const netWorth = aL + crypto + stocks;
        document.getElementById("result").textContent = "Net Worth: $" + netWorth.toFixed(2);
    }

    function saveNetWorthToFirebase() {
        const netWorthText = document.getElementById("result").textContent;

        if (!netWorthText || !netWorthText.includes("Net Worth: $")) {
            alert("Please calculate your net worth before saving.");
            return;
        }

        const netWorthValue = netWorthText.replace("Net Worth: $", "").trim();

        fetch("/api/profile", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ netWorth: parseFloat(netWorthValue) })
        })
            .then(res => {
                if (res.ok) {
                    alert("Net worth saved.");
                } else {
                    alert("Save failed.");
                }
            })
            .catch(() => alert("Save error."));
    }

    document.getElementById("netWorthForm").addEventListener("submit", function (e) {
        e.preventDefault();
        calculateNetWorth();
        saveNetWorthToFirebase();
    });

    window.addEventListener("DOMContentLoaded", () => {
        const theme = getThemePreference('theme');
        const body = document.body;
        if (theme === 'light') body.classList.add('light-mode');
        else if (theme === 'dark') body.classList.add('dark-mode');

        // Load net worth and profile image
        fetch("/api/profile", {
            method: "GET",
            headers: { "Content-Type": "application/json" }
        }).then(res => res.json()).then(data => {
            const fields = data.fields || {};
            if (fields.netWorth) {
                const netWorth = parseFloat(fields.netWorth.doubleValue);
                document.getElementById("result").textContent = "Net Worth: $" + netWorth.toFixed(2);
            }
            const img = fields.profileImage?.stringValue;
            if (img) document.getElementById("navProfileImage").src = img;
        });
    });
</script>
</body>
</html>